#include "./oled-display.h"

#define OLED_I2C_ADDRESS 0x3C

#define COMMAND_REG 0x80
#define DATA_REG 0x40

#define NORMAL_DISPLAY_CMD 0xAF
#define PAGE_ADDRESSING_MODE 0x02

volatile i2c_inst_t *m_i2c_port = NULL;

volatile uint8_t canvas[8][128] = {0};
volatile uint8_t canvas_row_index = 0;
volatile uint8_t canvas_column_index = 0;


#define LETTER_HEIGHT 8
#define LETTER_WIDTH 5
#define LETTER_GAP 1

// 32+32+31 = 95
bool ascii_characters[95][8][5] = {
    { // space
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
    },
    { // !
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,0,0,0},
        {0,0,1,0,0},
    },
    { // "
        {0,1,0,1,0},
        {0,1,0,1,0},
        {0,1,0,1,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
    },
    { // #
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,1,0,1,0},
        {1,1,1,1,1},
        {0,1,0,1,0},
        {1,1,1,1,1},
        {0,1,0,1,0},
        {0,0,0,0,0},
    },
    { // $
        {0,0,1,0,0},
        {0,1,1,1,0},
        {1,0,1,0,1},
        {0,1,1,0,0},
        {0,0,1,1,0},
        {1,0,1,0,1},
        {0,1,1,1,0},
        {0,0,1,0,0},
    },
    { // %
        {1,1,0,0,1},
        {1,1,0,1,0},
        {0,0,0,1,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,1,0,0,0},
        {0,1,0,1,1},
        {1,0,0,1,1},
    },
    { // &
        {0,1,1,0,0},
        {1,0,0,1,0},
        {1,0,0,1,0},
        {0,1,1,0,0},
        {1,0,1,0,1},
        {1,0,0,1,0},
        {1,0,0,1,1},
        {0,1,1,0,1},
    },
    { // '
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
    },
    { /* ( */
        {0,0,1,1,0},
        {0,1,0,0,0},
        {0,1,0,0,0},
        {0,1,0,0,0},
        {0,1,0,0,0},
        {0,1,0,0,0},
        {0,1,0,0,0},
        {0,0,1,1,0},
    },
    { /* ) */
        {0,1,1,0,0},
        {0,0,0,1,0},
        {0,0,0,1,0},
        {0,0,0,1,0},
        {0,0,0,1,0},
        {0,0,0,1,0},
        {0,0,0,1,0},
        {0,1,1,0,0},
    },
    { // *
        {0,0,0,0,0},
        {0,0,0,0,0},
        {1,0,1,0,1},
        {0,1,1,1,0},
        {1,1,1,1,1},
        {0,1,1,1,0},
        {1,0,1,0,1},
        {0,0,0,0,0},
    },
    { // +
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
    },
    { // ,
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,1,0},
        {0,0,0,1,0},
        {0,0,1,0,0},
    },
    { // -
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {1,1,1,1,1},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
    },
    { // .
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,1,0,0},
    },
    { // /
        {0,0,0,0,1},
        {0,0,0,0,1},
        {0,0,0,1,0},
        {0,0,0,1,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,1,0,0,0},
        {0,1,0,0,0},
    },
    { // 0
        {0,0,0,0,0},
        {0,1,1,1,0},
        {1,0,0,0,1},
        {1,0,0,1,1},
        {1,0,1,0,1},
        {1,1,0,0,1},
        {1,0,0,0,1},
        {0,1,1,1,0},
    },
    { // 1
        {0,0,0,0,0},
        {0,0,1,0,0},
        {0,1,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {1,1,1,1,1},
    },
    { // 2
        {0,0,0,0,0},
        {0,1,1,1,0},
        {1,0,0,0,1},
        {0,0,0,0,1},
        {0,0,1,1,0},
        {0,1,0,0,0},
        {1,0,0,0,0},
        {1,1,1,1,1},
    },
    { // 3
        {0,0,0,0,0},
        {0,1,1,1,0},
        {1,0,0,0,1},
        {0,0,0,0,1},
        {0,0,1,1,0},
        {0,0,0,0,1},
        {1,0,0,0,1},
        {0,1,1,1,0},
    },
    { // 4
        {0,0,0,0,0},
        {0,0,0,1,1},
        {0,0,1,0,1},
        {0,1,0,0,1},
        {1,0,0,0,1},
        {1,1,1,1,1},
        {0,0,0,0,1},
        {0,0,0,0,1},
    },
    { // 5
        {0,0,0,0,0},
        {1,1,1,1,1},
        {1,0,0,0,0},
        {1,1,1,1,0},
        {0,0,0,0,1},
        {0,0,0,0,1},
        {1,0,0,0,1},
        {0,1,1,1,0},
    },
    { // 6
        {0,0,0,0,0},
        {0,0,1,1,0},
        {0,1,0,0,0},
        {1,0,0,0,0},
        {1,1,1,1,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {0,1,1,1,0},
    },
    { // 7
        {0,0,0,0,0},
        {1,1,1,1,1},
        {1,0,0,0,1},
        {0,0,0,0,1},
        {0,0,0,1,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
    },
    { // 8
        {0,0,0,0,0},
        {0,1,1,1,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {0,1,1,1,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {0,1,1,1,0},
    },
    { // 9
        {0,0,0,0,0},
        {0,1,1,1,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {0,1,1,1,1},
        {0,0,0,0,1},
        {0,0,0,1,0},
        {0,1,1,0,0},
    },
    { // :
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,1,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,1,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
    },
    { // ;
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,1,0,0},
        {0,0,0,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,1,0,0,0},
        {0,0,0,0,0},
    },
    { // <
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,1,1},
        {0,1,1,0,0},
        {1,0,0,0,0},
        {0,1,1,0,0},
        {0,0,0,1,1},
        {0,0,0,0,0},
    },
    { // =
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {1,1,1,1,1},
        {0,0,0,0,0},
        {1,1,1,1,1},
        {0,0,0,0,0},
        {0,0,0,0,0},
    },
    { // >
        {0,0,0,0,0},
        {0,0,0,0,0},
        {1,1,0,0,0},
        {0,0,1,1,0},
        {0,0,0,0,1},
        {0,0,1,1,0},
        {1,1,0,0,0},
        {0,0,0,0,0},
    },
    { // ?
        {0,1,1,1,0},
        {1,0,0,0,1},
        {0,0,0,0,1},
        {0,0,0,1,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,0,0,0},
        {0,0,1,0,0},
    },
    { // @
        {0,1,1,1,0},
        {1,0,0,0,1},
        {0,0,1,0,1},
        {1,0,1,1,1},
        {1,0,1,0,1},
        {1,0,1,1,0},
        {1,0,0,0,0},
        {0,1,1,1,0},
    },
    { // A
        {0,0,0,0,0},
        {0,1,1,1,0},
        {1,0,0,0,1},
        {1,1,1,1,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
    },
    { // B
        {0,0,0,0,0},
        {1,1,1,1,0},
        {1,0,0,0,1},
        {1,1,1,1,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,1,1,1,0},
    },
    { // C
        {0,0,0,0,0},
        {0,1,1,1,0},
        {1,0,0,0,1},
        {1,0,0,0,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
        {1,0,0,0,1},
        {0,1,1,1,0},
    },
    { // D
        {0,0,0,0,0},
        {1,1,1,1,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,1,1,1,0},
    },
    { // E
        {0,0,0,0,0},
        {1,1,1,1,1},
        {1,0,0,0,0},
        {1,1,1,0,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
        {1,1,1,1,1},
    },
    { // F
        {0,0,0,0,0},
        {1,1,1,1,1},
        {1,0,0,0,0},
        {1,1,1,0,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
    },
    { // G
        {0,0,0,0,0},
        {0,1,1,1,1},
        {1,0,0,0,0},
        {1,0,0,1,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {0,1,1,1,0},
    },
    { // H
        {0,0,0,0,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,1,1,1,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
    },
    { // I
        {0,0,0,0,0},
        {0,1,1,1,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,1,1,1,0},
    },
    { // J
        {0,0,0,0,0},
        {0,0,0,0,1},
        {0,0,0,0,1},
        {0,0,0,0,1},
        {0,0,0,0,1},
        {0,0,0,0,1},
        {1,0,0,0,1},
        {0,1,1,1,0},
    },
    { // K
        {0,0,0,0,0},
        {1,0,0,0,1},
        {1,0,0,1,0},
        {1,1,1,0,0},
        {1,0,0,1,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
    },
    { // L
        {0,0,0,0,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
        {1,1,1,1,1},
    },
    { // M
        {0,0,0,0,0},
        {1,0,0,0,1},
        {1,1,0,1,1},
        {1,0,1,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
    },
    { // N
        {0,0,0,0,0},
        {1,0,0,0,1},
        {1,1,0,0,1},
        {1,0,1,0,1},
        {1,0,0,1,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
    },
    { // O
        {0,0,0,0,0},
        {0,1,1,1,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {0,1,1,1,0},
    },
    { // P
        {0,0,0,0,0},
        {1,1,1,1,0},
        {1,0,0,0,1},
        {1,1,1,1,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
    },
    { // Q
        {0,0,0,0,0},
        {0,1,1,1,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,1,0},
        {0,1,1,0,1},
    },
    { // R
        {0,0,0,0,0},
        {1,1,1,1,0},
        {1,0,0,0,1},
        {1,1,1,1,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
    },
    { // S
        {0,0,0,0,0},
        {0,1,1,1,1},
        {1,0,0,0,0},
        {0,1,1,1,0},
        {0,0,0,0,1},
        {0,0,0,0,1},
        {1,0,0,0,1},
        {0,1,1,1,0},
    },
    { // T
        {0,0,0,0,0},
        {1,1,1,1,1},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
    },
    { // U
        {0,0,0,0,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {0,1,1,1,0},
    },
    { // V
        {0,0,0,0,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {0,1,0,1,0},
        {0,1,0,1,0},
        {0,0,1,0,0},
    },
    { // W
        {0,0,0,0,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,1,0,1},
        {1,1,0,1,1},
        {1,0,0,0,1},
    },
    { // X
        {0,0,0,0,0},
        {1,0,0,0,1},
        {0,1,0,1,0},
        {0,0,1,0,0},
        {0,1,0,1,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
    },
    { // Y
        {0,0,0,0,0},
        {1,0,0,0,1},
        {0,1,0,1,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
    },
    { // Z
        {0,0,0,0,0},
        {1,1,1,1,1},
        {0,0,0,0,1},
        {0,0,0,1,0},
        {0,0,1,0,0},
        {0,1,0,0,0},
        {1,0,0,0,0},
        {1,1,1,1,1},
    },
    { // [
        {0,1,1,1,0},
        {0,1,0,0,0},
        {0,1,0,0,0},
        {0,1,0,0,0},
        {0,1,0,0,0},
        {0,1,0,0,0},
        {0,1,0,0,0},
        {0,1,1,1,0},
    },
    { /* \ */
        {1,0,0,0,0},
        {1,0,0,0,0},
        {0,1,0,0,0},
        {0,1,0,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,0,1,0},
        {0,0,0,1,0},
    },
    { /* [ */
        {0,1,1,1,0},
        {0,0,0,1,0},
        {0,0,0,1,0},
        {0,0,0,1,0},
        {0,0,0,1,0},
        {0,0,0,1,0},
        {0,0,0,1,0},
        {0,1,1,1,0},
    },
    { // ^
        {0,0,1,0,0},
        {0,1,0,1,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
    },
    { // _
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {1,1,1,1,1},
    },
    { // `
        {0,1,0,0,0},
        {0,0,1,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
    },
    { // a
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,1,1,1,0},
        {0,0,0,0,1},
        {0,1,1,1,1},
        {1,0,0,0,1},
        {0,1,1,1,0},
    },
    { // b
        {0,0,0,0,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
        {1,0,1,1,0},
        {1,1,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,1,1,1,0},
    },
    { // c
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,1,1,1,0},
        {1,0,0,0,1},
        {1,0,0,0,0},
        {1,0,0,0,1},
        {0,1,1,1,0},
    },
    { // d
        {0,0,0,0,0},
        {0,0,0,0,1},
        {0,0,0,0,1},
        {0,1,1,0,1},
        {1,0,0,1,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {0,1,1,1,1},
    },
    { // e
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,1,1,1,0},
        {1,0,0,0,1},
        {1,1,1,1,1},
        {1,0,0,0,0},
        {0,1,1,1,1},
    },
    { // f
        {0,0,0,0,0},
        {0,0,1,1,0},
        {0,1,0,0,0},
        {1,1,1,1,0},
        {0,1,0,0,0},
        {0,1,0,0,0},
        {0,1,0,0,0},
        {0,1,0,0,0},
    },
    { // g
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,1,1,1,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {0,1,1,1,1},
        {0,0,0,0,1},
        {1,1,1,1,0},
    },
    { // h
        {0,0,0,0,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
        {1,0,1,1,0},
        {1,1,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
    },
    { // i
        {0,0,0,0,0},
        {0,0,1,0,0},
        {0,0,0,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
    },
    { // j
        {0,0,0,0,0},
        {0,0,0,0,1},
        {0,0,0,0,0},
        {0,0,0,0,1},
        {0,0,0,0,1},
        {0,0,0,0,1},
        {1,0,0,0,1},
        {0,1,1,1,0},
    },
    { // k
        {0,0,0,0,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
        {1,0,0,1,0},
        {1,0,1,0,0},
        {1,1,0,0,0},
        {1,0,1,0,0},
        {1,0,0,1,0},
    },
    { // l
        {0,0,0,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,0,1,0},
    },
    { // m
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {1,1,0,1,0},
        {1,0,1,0,1},
        {1,0,1,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
    },
    { // n
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {1,1,1,1,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
    },
    { // o
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,1,1,1,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {0,1,1,1,0},
    },
    { // p
        {0,0,0,0,0},
        {0,0,0,0,0},
        {1,0,1,1,0},
        {1,1,0,0,1},
        {1,0,0,0,1},
        {1,1,1,1,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
    },
    { // q
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,1,1,0,1},
        {1,0,0,1,1},
        {1,0,0,0,1},
        {0,1,1,1,1},
        {0,0,0,0,1},
        {0,0,0,0,1},
    },
    { // r
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {1,0,1,1,0},
        {1,1,0,0,1},
        {1,0,0,0,0},
        {1,0,0,0,0},
        {1,0,0,0,0},
    },
    { // s
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,1,1,1,1},
        {1,0,0,0,0},
        {0,1,1,1,0},
        {0,0,0,0,1},
        {1,1,1,1,0},
    },
    { // t
        {0,0,0,0,0},
        {0,0,1,0,0},
        {0,1,1,1,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,0,1,0},
    },
    { // u
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {0,1,1,1,1},
    },
    { // v
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {0,1,0,1,0},
        {0,0,1,0,0},
    },
    { // w
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,1,0,1},
        {1,0,1,0,1},
        {0,1,1,1,1},
    },
    { // x
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {1,0,0,0,1},
        {0,1,0,1,0},
        {0,0,1,0,0},
        {0,1,0,1,0},
        {1,0,0,0,1},
    },
    { // y
        {0,0,0,0,0},
        {0,0,0,0,0},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {1,0,0,0,1},
        {0,1,1,1,1},
        {0,0,0,0,1},
        {1,1,1,1,0},
    },
    { // z
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {1,1,1,1,1},
        {0,0,0,1,0},
        {0,0,1,0,0},
        {0,1,0,0,0},
        {1,1,1,1,1},
    },
    { /* { */
        {0,0,1,1,0},
        {0,1,0,0,0},
        {0,1,0,0,0},
        {1,0,0,0,0},
        {0,1,0,0,0},
        {0,1,0,0,0},
        {0,1,0,0,0},
        {0,0,1,1,0},
    },
    { // |
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
        {0,0,1,0,0},
    },
    { /* } */
        {0,1,1,0,0},
        {0,0,0,1,0},
        {0,0,0,1,0},
        {0,0,0,0,1},
        {0,0,0,1,0},
        {0,0,0,1,0},
        {0,0,0,1,0},
        {0,1,1,0,0},
    },
    { // ~
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
        {0,1,0,0,0},
        {1,0,1,0,1},
        {0,0,0,1,0},
        {0,0,0,0,0},
        {0,0,0,0,0},
    },
};

void init_oled_display(i2c_inst_t *i2c_port, uint8_t sda_pin, uint8_t scl_pin){

    // Init on default i2c
    i2c_init(i2c_port, 100000); // Specify the desired I2C clock speed (e.g., 100 kHz)

    gpio_set_function(sda_pin, GPIO_FUNC_I2C);
    gpio_set_function(scl_pin, GPIO_FUNC_I2C);
    gpio_pull_up(sda_pin);
    gpio_pull_up(scl_pin);

    // Enable the I2C interface
    i2c_set_slave_mode(i2c_port, false, 0x00);
    //i2c_set_master_mode(i2c_port, true);

    m_i2c_port = i2c_port;

    oled_turn_on();
    oled_set_mode_normal();
    oled_set_page_mode();
    oled_write_command(0x8d);
    oled_write_command(0x14);
    oled_full_clear();
    oled_set_cursor(0, 0);
    
    for(uint page = 0; page < 8; page++){
        oled_set_cursor(0, page);
        for(uint column = 0; column < 128; column++){
            oled_write_data(0b11111111);
        }
    }
    oled_set_cursor(0, 0);
}

void oled_write_command(uint8_t command){
    uint8_t buf[2];
    buf[0] = COMMAND_REG;
    buf[1] = command;

    i2c_write_blocking(m_i2c_port, OLED_I2C_ADDRESS, buf, 2, false);
}

void oled_write_data(uint8_t data){
    uint8_t buf[2];
    buf[0] = DATA_REG;
    buf[1] = data;
    i2c_write_blocking(m_i2c_port, OLED_I2C_ADDRESS, buf, 2, false);
}

void oled_turn_on(){
    oled_write_command(SET_DISPLAY_ON);
}

void oled_turn_off(){
    oled_write_command(SET_DISPLAY_OFF);
}

void oled_set_mode_normal(){
    // Inverted or normal mode
    oled_write_command(SET_DISPLAY_NORMAL);
}

void oled_set_mode_inverted(){
    // Inverted or normal mode
    oled_write_command(SET_DISPLAY_INVERSE);
}

void oled_set_page_mode(){
    oled_write_command(SET_ADDRESSING_MODE); // Set addressing mode
    oled_write_command(MODE_PAGE_ADDRESSING); // set page addressing mode
}

void oled_full_clear(){
    for(uint page = 0; page < 8; page++){
        oled_set_cursor(0, page);
        for(uint column = 0; column < 128; column++){
            oled_write_data(0x00);
        }
    }
    oled_set_cursor(0, 0);
}

void oled_set_cursor(uint8_t x, uint8_t y){
    oled_write_command(0x00 + (x & 0x0F));
    oled_write_command(0x10 + ((x >> 4) & 0x0F));
    oled_write_command(0xB0 + y);
}

void oled_canvas_clear(){
    for(uint page = 0; page < 8; page++){
        for(uint column = 0; column < 128; column++){
            canvas[page][column] = 0;
        }
    }

    canvas_row_index = 0;
    canvas_column_index = 0;
}

void oled_canvas_write(const char *string, uint8_t string_length, bool flip_letters){
    for(uint i = 0; i < string_length; i++){

        uint8_t character_number = string[i] - 32;
        // printf("%c %d %d  row index %d  col index %d \n", string[i], string[i], string[i] - 32, canvas_row_index);

        // Handle new line 
        if(string[i] == '\n'){
            canvas_row_index++;
            canvas_column_index = 0;
            continue;
        }

        // If went beyond the edge go to the next line
        if((canvas_column_index + LETTER_WIDTH + LETTER_GAP) > 127 || string[i] == '\n'){
            canvas_row_index++;
            canvas_column_index = 0;
            if(canvas_row_index > 7){
                // Not enough rows on display to continue
                return;
            }
        }
        
        // Start writing the ascii letter to the canvas
        for(uint column = 0; column < LETTER_WIDTH; column++){
            
            // Get a single column of the correct character. Column 0 is the left most column
            uint8_t column_value = 0;
            for(uint column_row = 0; column_row < LETTER_HEIGHT; column_row++){
                if(flip_letters){
                    column_value |= (ascii_characters[character_number][column_row][column] << (column_row));
                }else{
                    column_value |= (ascii_characters[character_number][column_row][column] << (7-column_row));
                }
            }
            // use canvas indexes but follow which column to write to by column loop
            canvas[canvas_row_index][canvas_column_index+column] = column_value;
        }

        // Increment the column index so that the new letter can start
        canvas_column_index += LETTER_WIDTH + LETTER_GAP; // 5 For letter width 1 for small gap between letters
    }
}

void oled_canvas_show(){
    //oled_full_clear();
    oled_set_cursor(0, 0);
    
    for(uint page = 0; page < 8; page++){
        oled_set_cursor(0, page);
        for(uint column = 0; column < 128; column++){
            oled_write_data(canvas[page][column]);
        }
    }
    oled_set_cursor(0, 0);
}

void oled_canvas_invert_row(uint8_t row_index){
    for(uint page = 0; page < 8; page++){
        if(row_index == page){
            for(uint column = 0; column < 128; column++){
                canvas[page][column] = ~canvas[page][column];
            }
            break;
        }
    }
}